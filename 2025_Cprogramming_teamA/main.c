#include <stdio.h>
#include "common.h" 
#include "book.h"
#include "user.h"
#include "auth.h"

// main.cï¿½ï¿½ ï¿½Ö¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½Ä¡
// ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½Ö·ï¿½ ï¿½Úµï¿½ï¿½Û¼ï¿½ï¿½Ï±ï¿½
// ï¿½ï¿½ï¿½ï¿½1 -> user.c (ï¿½Ô¼ï¿½3ï¿½ï¿½)
// ï¿½ï¿½ï¿½ï¿½2 -> book.c (ï¿½Ô¼ï¿½3ï¿½ï¿½)
// ï¿½ï¿½ï¿½ï¿½3 -> auth.c (È¸ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½)
// ï¿½ï¿½ï¿½ï¿½4 -> auth.c (ï¿½Î±ï¿½ï¿½ï¿½)
// [ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½]
// ï¿½ï¿½ï¿½Î±×·ï¿½ ï¿½ï¿½Ã¼ï¿½ï¿½ï¿½ï¿½ ï¿½Þ¸ð¸®´ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½â¼­ï¿½ï¿½ ï¿½Ò´ï¿½ï¿?
Book g_books[MAX_BOOKS]; // Ã¥ ï¿½è¿­ ï¿½ï¿½ï¿½ï¿½
User g_users[MAX_USERS]; // ï¿½ï¿½ï¿½ï¿½ ï¿½è¿­ ï¿½ï¿½ï¿½ï¿½
int g_bookCount = 0; // Ã¥ Ä«ï¿½ï¿½Æ® ï¿½Ê±ï¿½È­
int g_userCount = 0; // ï¿½ï¿½ï¿½ï¿½ Ä«ï¿½ï¿½Æ® ï¿½Ê±ï¿½È­

int main() {
    // 1. ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Îµï¿½
    loadBooks(); // Ã¥ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Îµï¿½
    loadUsers(); // ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Îµï¿½

    char choiceStr[10]; // ï¿½Ô·Â°ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½Ú¿ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½
    int choice; // switchï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
    int isLoggedIn = 0; // ï¿½Î±ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½Ã¼Å© (0: ï¿½Î±×¿ï¿½ï¿½ï¿½, 1: ï¿½Î±ï¿½ï¿½ï¿½)

    // 2. ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½
    while (1) {
        printf("\n=== ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½Î±×·ï¿½ ===\n");
        printf("1. È¸ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\n");
        printf("2. ï¿½Î±ï¿½ï¿½ï¿½\n");
        printf("3. ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ (Admin)\n");
        printf("4. È¸ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ (Admin)\n");
        printf("0. ï¿½ï¿½ï¿½ï¿½\n");
        printf("ï¿½ï¿½ï¿½ï¿½: ");

        // 1. ï¿½Ô·Â¹Þ±ï¿½
        if (fgets(choiceStr, sizeof(choiceStr), stdin) == NULL) { // choiceStrï¿½ï¿½ï¿½ï¿½ ï¿½Þ¾Æ¼ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Ã·Î¿ï¿½Å¼ï¿?NULLï¿½ï¿½ ï¿½ï¿½È¯ï¿½Ç¸ï¿½
            printf("ï¿½Ô·ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Ô´Ï´ï¿½.\n"); // ï¿½Ô·Â¿ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿?
            continue; // ï¿½ï¿½ï¿½ï¿½ ï¿½Úµï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê°ï¿½ ï¿½Ê±ï¿½ï¿?ï¿½ï¿½Æ¼ï¿½ï¿½
        }
        // 2. ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ (ï¿½ï¿½ï¿½ï¿½Å° ï¿½ï¿½ï¿½Ú·ï¿½ ï¿½Þ´Â°ï¿½ ï¿½ï¿½ï¿½Ö±ï¿½)
        choiceStr[strcspn(choiceStr, "\r\n")] = '\0'; // r nï¿½ï¿½ï¿½ï¿½ ï¿½Ñ°ï¿½ï¿½Ì¶ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ NULLï¿½ï¿½ ï¿½ï¿½È¯ 

        // 3. ï¿½ï¿½ ï¿½Ô·ï¿½ È®ï¿½ï¿½ (ï¿½×³ï¿½ ï¿½ï¿½ï¿½Í¸ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½)
        if (choiceStr[0] == '\0') { // NULLï¿½ï¿½ï¿½ï¿½ ï¿½Ô·ÂµÇ¸ï¿½
            printf("ï¿½Æ¹ï¿½ï¿½Íµï¿½ ï¿½Ô·ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Ê¾Ò½ï¿½ï¿½Ï´ï¿½.\n"); // ï¿½ï¿½ï¿½ï¿½ï¿½Þ½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿?
            continue; // ï¿½Ê±ï¿½ï¿?ï¿½ï¿½Æ¼ï¿½ï¿½
        }

        // 4. ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ ï¿½ï¿½ï¿½Ú¾ï¿½ ï¿½Ë»ï¿½
        int isNumber = 1; // "ï¿½ï¿½ï¿½Ú°ï¿½ ï¿½Â´ï¿½"ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Ï°ï¿½ ï¿½ï¿½ï¿½ï¿½
        for (int i = 0; choiceStr[i] != '\0'; i++) { // choiceStr ï¿½è¿­ 0ï¿½ï¿½ï¿½ï¿½ ï¿½Ë»ï¿½ï¿½ï¿½ï¿?
            // isdigit: ï¿½ï¿½ï¿½Ú°ï¿½ '0'~'9' ï¿½ï¿½ï¿½Ì¸ï¿½ ï¿½ï¿½, ï¿½Æ´Ï¸ï¿½ ï¿½ï¿½ï¿½ï¿½
            if (!isdigit(choiceStr[i])) { // isdigitï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ falseï¿½Ì¸ï¿½ !isdigit ï¿½ï¿½ trueï¿½Ì¹Ç·ï¿½ ï¿½ï¿½ï¿½Ç¹ï¿½ï¿½ï¿½ï¿½ï¿½ 
                isNumber = 0; // ï¿½ï¿½ï¿½Ú°ï¿½ ï¿½Æ´Ñ°ï¿½ ï¿½ß°ßµÇ¸ï¿½
                break;        // ï¿½ß´ï¿½
            }
        }

        // 5. ï¿½ï¿½ï¿½Ú°ï¿½ ï¿½Æ´Ï¶ï¿½ï¿?ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿?ï¿½ï¿½ Ã³ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
        if (isNumber == 0) { // isNumber 1ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Ï°ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ß´Âµï¿½ 4ï¿½ï¿½ï¿½ï¿½ï¿½Ç¹ï¿½ï¿½ï¿½ ï¿½ï¿½Ä¡ï¿½ï¿½ 0ï¿½ï¿½ï¿½ÌµÇ¸ï¿½
            printf("ï¿½ï¿½ï¿½Ú¸ï¿½ ï¿½Ô·ï¿½ï¿½ï¿½ï¿½Ö¼ï¿½ï¿½ï¿½.\n"); // ï¿½ï¿½ï¿½ï¿½ï¿½Þ½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿?
            continue; // ï¿½Ê±ï¿½ï¿?ï¿½ï¿½Æ¼ï¿½ï¿½
        }
        choice = atoi(choiceStr); // ï¿½ï¿½ï¿½Ú¿ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½È¯ fgetsï¿½ï¿½ ï¿½ï¿½ï¿½Ú¿ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ atoiï¿½ï¿½ ï¿½Ì¿ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½È¯ï¿½ï¿½ï¿½Ø´ï¿½.

        switch (choice) {
        case 1:
            signUp(); // È¸ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Ô¼ï¿½È£ï¿½ï¿½
            break;
        case 2:
            isLoggedIn = login(); // ï¿½Î±ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½È¯
            break;
        case 3:
            manageBooks(); // Ã¥ï¿½ï¿½ï¿½ï¿½ ï¿½Ô¼ï¿½È£ï¿½ï¿½
            break;
        case 4:
            manageUsers(); // ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½Ô¼ï¿½È£ï¿½ï¿½
            break;
        case 0:
             //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
            saveBooks(); // Ã¥ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
            saveUsers(); // ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
            printf("ï¿½ï¿½ï¿½Î±×·ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Õ´Ï´ï¿½.\n"); // ï¿½ï¿½ï¿½Î±×·ï¿½ ï¿½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿?
            return 0; // 0ï¿½ï¿½ï¿½ï¿½
        default: // ï¿½ï¿½ï¿½ï¿½Æ®ï¿½ï¿½
            printf("ï¿½ß¸ï¿½ï¿½ï¿½ ï¿½Ô·ï¿½ï¿½Ô´Ï´ï¿½.\n"); // ï¿½ï¿½ï¿½ï¿½ï¿½Þ½ï¿½ï¿½ï¿½ ï¿½ï¿½ï¿?
        }
    }
    return 0; // 0ï¿½ï¿½ï¿½ï¿½
}

